<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[小前风]]></title>
  
  <link href="/atom.xml" rel="self"/>
  <link href="https://annilq.github.io/"/>
  <updated>2017-11-28T13:48:55.000Z</updated>
  <id>https://annilq.github.io/</id>
  
  <author>
    <name><![CDATA[annilq]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[几种常见的数据结构]]></title>
    <link href="https://annilq.github.io/2017/11/28/datastructures/"/>
    <id>https://annilq.github.io/2017/11/28/datastructures/</id>
    <published>2017-11-28T13:38:01.000Z</published>
    <updated>2017-11-28T13:48:55.000Z</updated>
    <content type="html"><![CDATA[<h2 id="u51E0_u79CD_u5E38_u89C1_u7684_u6570_u636E_u7ED3_u6784"><a href="#u51E0_u79CD_u5E38_u89C1_u7684_u6570_u636E_u7ED3_u6784" class="headerlink" title="几种常见的数据结构"></a>几种常见的数据结构</h2><ol>
<li>Stack栈</li>
<li>Queue队列</li>
<li>LinkedList链表</li>
<li>Set集合</li>
<li>Map字典、散列表</li>
<li>Tree树</li>
<li>图(还不理解)</li>
</ol>
<h3 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h3><p>栈是一种遵从后进先出原则的有序集合</p>
<ul>
<li>push() 添加一个新元素到栈顶</li>
<li>pop() 移除栈顶的元素，并且返回移除的元素</li>
<li>peek() 返回栈顶的元素</li>
<li>isEmpty() 判断栈是否为空</li>
<li>clear()清空栈</li>
<li>size() 返回栈元素个数</li>
</ul>
<p>应用：十进制转换二进制</p>
<h3 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h3><p>队列是遵从先进先出原则的一组有序集合</p>
<ul>
<li>enqueue() 向队列尾部添加新元素</li>
<li>dequeue() 移除队列第一个元素，并返回该元素</li>
<li>front() 返回队列的第一个元素</li>
<li>isEmpty() 判断队列是否为空</li>
<li><p>size() 返回队列的元素个数</p>
<p>其他修改版本的队列实现</p>
</li>
<li><p>优先队列 应用：医院排队</p>
<blockquote>
<p>需要构建一个包含优先级的元素</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Node=<span class="function"><span class="keyword">function</span>(<span class="params">element,priority</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.element=element;</span><br><span class="line">  <span class="keyword">this</span>.priority=priority;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>循环队列 应用：击鼓传花游戏</p>
</li>
</ul>
<h3 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h3><p>链表是有序的元素集合，不同于集合，链表中的元素在内存中不是连续放置的，每个元素由一个存储元素本身的节点和一个指向下一个元素的引用组成</p>
<ul>
<li>append(element) 向链表尾处添加一个元素</li>
<li>insert(position,element) 向指定位置添加一个元素</li>
<li>remove(element) 移除指定元素</li>
<li>indexOf(element) 返回元素在链表中的索引</li>
<li>removeAt(position) 移除指定位置的元素</li>
<li>isEmpty() 判断链表是否为空</li>
<li>size() 返回链表元素个数</li>
<li><p>toString() 由于链表项使用了Node类，就需要重写继承自javascript对象默认的toString方法，让其只输出元素的值</p>
<p>其他修改版本的队列实现</p>
</li>
<li><p>双向链表 :双向链表中链接是双向的，一个链接向上的一个链接向下的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Node=<span class="function"><span class="keyword">function</span>(<span class="params">element</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.element=element;</span><br><span class="line">  <span class="keyword">this</span>.prev=<span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.next=<span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>循环链表 :循环链表与链表的唯一区别在于,最后一个元素指向下一个元素的指针不是null,而是第一个元素head</p>
<blockquote>
<p>ps:使用Stack 、Queue与LinkedList之间的区别</p>
<ul>
<li>Stack 、Queue相对于链表来说数据结构简单，并且(再大多数语言中)数组的大小是固定的，不容易扩容，链表可以动态扩容</li>
<li>从Stack 、Queue起点或中间插入或移除元素成本非常高，因为需要移动元素，而链表不需要移动元素</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p>集合是一组无序且唯一的项组成的</p>
<p>  集合方法</p>
<ul>
<li>add(value) 添加一个元素到集合中</li>
<li>delete(value) 删除集合中的一个元素</li>
<li>has(value) 判断值是否在集合中</li>
<li>clear() 清空集合</li>
<li>size() 返回集合中的元素数量</li>
<li>values() 返回一个包含集合中所有值的数组</li>
</ul>
<p>  集合操作</p>
<ul>
<li>union 并集</li>
<li>intersection 交集</li>
<li>difference 差集</li>
<li>subset 子集</li>
</ul>
<h3 id="Map_2CHashTable"><a href="#Map_2CHashTable" class="headerlink" title="Map,HashTable"></a>Map,HashTable</h3>]]></content>
    <summary type="html">
    <![CDATA[<h2 id="u51E0_u79CD_u5E38_u89C1_u7684_u6570_u636E_u7ED3_u6784"><a href="#u51E0_u79CD_u5E38_u89C1_u7684_u6570_u636E_u7ED3_u6784" class="heade]]>
    </summary>
    
      <category term="数据结构" scheme="https://annilq.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[RxJS 小记]]></title>
    <link href="https://annilq.github.io/2017/11/09/rxjs/"/>
    <id>https://annilq.github.io/2017/11/09/rxjs/</id>
    <published>2017-11-09T11:30:01.000Z</published>
    <updated>2017-11-09T11:35:39.000Z</updated>
    <content type="html"><![CDATA[<h3 id="u7B80_u5355_u6765_u8BF4_Observable_u662F_u4E00_u4E2A_u63A5_u6536observer_u5E76_u4E14_u8FD4_u56DE_u4E00_u4E2A_u53EF_u7528_u4E8E_u53D6_u6D88_u8BA2_u9605_u65B9_u6CD5_u7684_u65B9_u6CD5"><a href="#u7B80_u5355_u6765_u8BF4_Observable_u662F_u4E00_u4E2A_u63A5_u6536observer_u5E76_u4E14_u8FD4_u56DE_u4E00_u4E2A_u53EF_u7528_u4E8E_u53D6_u6D88_u8BA2_u9605_u65B9_u6CD5_u7684_u65B9_u6CD5" class="headerlink" title="简单来说 Observable是一个接收observer并且返回一个可用于取消订阅方法的方法"></a>简单来说 Observable是一个接收observer并且返回一个可用于取消订阅方法的方法</h3><p>下面是一个比较基础的实现<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myObservable</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> datasource = <span class="keyword">new</span> DataSource();</span><br><span class="line">    datasource.ondata = (e) =&gt; observer.next(e);</span><br><span class="line">    datasource.onerror = (err) =&gt; observer.error(err);</span><br><span class="line">    datasource.oncomplete = () =&gt; observer.complete();</span><br><span class="line">    <span class="keyword">return</span> () =&gt; &#123;</span><br><span class="line">        datasource.destroy();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>一个健全一点的观察者应该保证以下几点</p>
<ol>
<li><code>next</code>，<code>error</code>和<code>complete</code>实际上都是可选的。你不必处理每个值，或错误或完成。</li>
<li>你不能在<code>complete</code>和<code>error</code>之后调用next</li>
<li>调用<code>complete</code>和<code>error</code>后需要调用取消订阅逻辑。</li>
<li>只有执行订阅方法,才会接收到数据源的值</li>
<li>如果你的<code>next</code>,<code>complete</code>或<code>error</code>处理程序抛出一个异常，你想调用你的取消订阅逻辑。</li>
</ol>
<h3 id="u5B9E_u73B0_u4E00_u4E2A_u7C7BRxJS_u9700_u8981_u5B9E_u73B0_u4EE5_u4E0B_u51E0_u90E8_u5206"><a href="#u5B9E_u73B0_u4E00_u4E2A_u7C7BRxJS_u9700_u8981_u5B9E_u73B0_u4EE5_u4E0B_u51E0_u90E8_u5206" class="headerlink" title="实现一个类RxJS需要实现以下几部分"></a>实现一个类RxJS需要实现以下几部分</h3><ol>
<li>数据源</li>
<li>observer</li>
<li>Observable生成器</li>
<li>observable</li>
<li>operator</li>
</ol>
<h4 id="u6570_u636E_u6E90"><a href="#u6570_u636E_u6E90" class="headerlink" title="数据源"></a>数据源</h4><ul>
<li>数据源可以产生数据给observer</li>
</ul>
<h4 id="observer"><a href="#observer" class="headerlink" title="observer"></a>observer</h4><ul>
<li>包含  <code>next</code>, <code>error</code> and <code>complete</code> 属性的对象，用来处理数据源的数据</li>
</ul>
<h4 id="Observable__u751F_u6210_u5668_u51FD_u6570"><a href="#Observable__u751F_u6210_u5668_u51FD_u6570" class="headerlink" title="Observable 生成器函数"></a>Observable 生成器函数</h4><ul>
<li>接收一个observer对象(该observer由observable传入并且经过包装后得到)，并且将observer和数据源关联</li>
</ul>
<h4 id="observable"><a href="#observable" class="headerlink" title="observable"></a>observable</h4><ul>
<li>由Observable生成器函数生成，并带有一个接收observer对象的subscribe方法</li>
</ul>
<h4 id="operator"><a href="#operator" class="headerlink" title="operator"></a>operator</h4><ul>
<li>操作符是一个接收observable并且返回新observable的函数</li>
<li>操作符在做什么：当你订阅它的返回的observable时，它创建一个<code>mapObserver</code>来完成工作并将<code>observer</code>和<code>mapObserver</code>链接在一起。建立operator实际上只是创建一个用于在订阅时连接观察者的模板</li>
</ul>
<h2 id="Observable_u6267_u884C_u987A_u5E8F"><a href="#Observable_u6267_u884C_u987A_u5E8F" class="headerlink" title="Observable执行顺序"></a>Observable执行顺序</h2><ol>
<li>Observable生成器函数生成一个observable</li>
<li>observable调用subscribe时传入一个observer，并返回一个订阅Subscription对象</li>
<li>将observer与数据源关联</li>
<li>数据源发出数据时调用observer相关方法</li>
<li>可以调用订阅对象Subscription的unsubscribe方法取消订阅</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  -------------------------------DataSource----------------------------</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventDataSource</span> </span>&#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">this</span>._id = setInterval(() =&gt; <span class="keyword">this</span>.emit(i++), <span class="number">200</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  emit(n) &#123;</span><br><span class="line">    <span class="keyword">const</span> limit = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.ondata) &#123;</span><br><span class="line">      <span class="keyword">this</span>.ondata(n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n === limit) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.oncomplete) &#123;</span><br><span class="line">        <span class="keyword">this</span>.oncomplete();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.destroy();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  destroy() &#123;</span><br><span class="line">    clearInterval(<span class="keyword">this</span>._id);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ArraySource=[<span class="string">"hello"</span>, <span class="string">"annilq"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PromiseSource=<span class="built_in">Promise</span>.resolve(<span class="string">"promise"</span>);</span><br><span class="line"><span class="comment">//  -------------------------------DataSource end----------------------------</span></span><br><span class="line"><span class="comment">//  -------------------------------Observable creator----------------------------</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SafeObserver</span> </span>&#123;</span><br><span class="line">  constructor(destination) &#123;</span><br><span class="line">    <span class="keyword">this</span>.destination = destination;</span><br><span class="line">  &#125;</span><br><span class="line">  next(value) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.isUnsubscribed &amp;&amp; <span class="keyword">this</span>.destination.next) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.destination.next(value);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">this</span>.unsubscribe();</span><br><span class="line">        <span class="keyword">throw</span> err;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  error(err) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.isUnsubscribed &amp;&amp; <span class="keyword">this</span>.destination.error) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.destination.error(err);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e2) &#123;</span><br><span class="line">        <span class="keyword">this</span>.unsubscribe();</span><br><span class="line">        <span class="keyword">throw</span> e2;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.unsubscribe();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  complete() &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.isUnsubscribed &amp;&amp; <span class="keyword">this</span>.destination.complete) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.destination.complete();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">this</span>.unsubscribe();</span><br><span class="line">        <span class="keyword">throw</span> err;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.unsubscribe();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  unsubscribe() &#123;</span><br><span class="line">    <span class="keyword">this</span>.isUnsubscribed = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.unsub) &#123;</span><br><span class="line">      <span class="keyword">this</span>.unsub();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observable</span> </span>&#123;</span><br><span class="line">  constructor(_subscribe) &#123;</span><br><span class="line">    <span class="keyword">this</span>._subscribe = _subscribe;</span><br><span class="line">  &#125;</span><br><span class="line">  subscribe(observer) &#123;</span><br><span class="line">    <span class="keyword">const</span> safeObserver = <span class="keyword">new</span> SafeObserver(observer);</span><br><span class="line">    safeObserver.unsub = <span class="keyword">this</span>._subscribe(safeObserver);</span><br><span class="line">    <span class="keyword">return</span> safeObserver.unsubscribe.bind(safeObserver);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">Observable.from = <span class="function"><span class="keyword">function</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Observable(observer =&gt; &#123;</span><br><span class="line">    arr.forEach(data =&gt; observer.next(data));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">Observable.fromEvent = <span class="function"><span class="keyword">function</span>(<span class="params">EventDataSource</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Observable(observer =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> datasource = <span class="keyword">new</span> EventDataSource();</span><br><span class="line">    datasource.ondata = e =&gt; observer.next(e);</span><br><span class="line">    datasource.onerror = err =&gt; observer.error(err);</span><br><span class="line">    datasource.oncomplete = () =&gt; observer.complete();</span><br><span class="line">    <span class="keyword">return</span> () =&gt; datasource.destroy();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">Observable.fromPromise = <span class="function"><span class="keyword">function</span>(<span class="params">promise</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Observable(observer =&gt; &#123;</span><br><span class="line">    promise.then(data =&gt; observer.next(data));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------observable end----------------------------------</span></span><br><span class="line"><span class="comment">// ----------------------------------Operators----------------------------------</span></span><br><span class="line"><span class="comment">// “运算符”返回个新的可观察对象，当您订阅它时,它将订阅该可观察对象</span></span><br><span class="line">Observable.prototype.map = <span class="function"><span class="keyword">function</span>(<span class="params">project</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Observable(observer =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> mapObserver = &#123;</span><br><span class="line">      next: x =&gt; observer.next(project(x)),</span><br><span class="line">      error: err =&gt; observer.error(err),</span><br><span class="line">      complete: () =&gt; observer.complete()</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.subscribe(mapObserver);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// ----------------------------------Operators end-------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------usage----------------------------------</span></span><br><span class="line"><span class="keyword">const</span> myObservable = <span class="keyword">new</span> Observable(observer =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> datasource = <span class="keyword">new</span> EventDataSource();</span><br><span class="line">  datasource.ondata = e =&gt; observer.next(e);</span><br><span class="line">  datasource.onerror = err =&gt; observer.error(err);</span><br><span class="line">  datasource.oncomplete = () =&gt; observer.complete();</span><br><span class="line">  <span class="keyword">return</span> () =&gt; datasource.destroy();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> myObservable1 = Observable.fromEvent(EventDataSource);</span><br><span class="line"><span class="keyword">const</span> myObservable2 = Observable.from(ArraySource);</span><br><span class="line"><span class="keyword">const</span> myObservable3 = Observable.fromPromise(PromiseSource);</span><br><span class="line">myObservable.map(x =&gt; x + x).subscribe(&#123;</span><br><span class="line">  next(x) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">myObservable1.subscribe(&#123;</span><br><span class="line">  next(x) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">myObservable2.subscribe(&#123;</span><br><span class="line">  next(x) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">myObservable3.subscribe(&#123;</span><br><span class="line">  next(x) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="RxJS_u5B9E_u73B0_u4E2D_u6D89_u53CA_u7684_u51E0_u4E2A_u6982_u5FF5_uFF1A"><a href="#RxJS_u5B9E_u73B0_u4E2D_u6D89_u53CA_u7684_u51E0_u4E2A_u6982_u5FF5_uFF1A" class="headerlink" title="RxJS实现中涉及的几个概念："></a>RxJS实现中涉及的几个概念：</h3><ol>
<li>Observable (可观察对象): 表示一个概念，这个概念是一个可调用的未来值或事件的集合。</li>
<li>Observer (观察者): 一个回调函数的集合，它知道如何去监听由 Observable 提供的值。</li>
<li>Subscription (订阅): 表示 Observable 的执行，主要用于取消 Observable 的执行。</li>
<li>Operators (操作符): 采用函数式编程风格的纯函数 (pure function)，使用像 map、filter、concat、flatMap 等这样的操作符来处理集合。</li>
<li>Subject (主体): 相当于 EventEmitter，并且是将值或事件多路推送给多个 Observer 的唯一方式。</li>
<li>Schedulers (调度器): 用来控制并发并且是中央集权的调度员，允许我们在发生计算时进行协调，例如 setTimeout 或 requestAnimationFrame 或其他。</li>
</ol>
<h3 id="u53C2_u8003"><a href="#u53C2_u8003" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://medium.com/@benlesh/learning-observable-by-building-observable-d5da57405d87" target="_blank" rel="external">Learning Observable By Building Observable – Ben Lesh – Medium</a></li>
<li><a href="http://cn.rx.js.org/manual/overview.html" target="_blank" rel="external">RxJS入门</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="u7B80_u5355_u6765_u8BF4_Observable_u662F_u4E00_u4E2A_u63A5_u6536observer_u5E76_u4E14_u8FD4_u56DE_u4E00_u4E2A_u53EF_u7528_u4E8E_u53D6]]>
    </summary>
    
      <category term="RxJS observable" scheme="https://annilq.github.io/tags/RxJS-observable/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[observer pattern小记]]></title>
    <link href="https://annilq.github.io/2017/10/11/observable-pattern/"/>
    <id>https://annilq.github.io/2017/10/11/observable-pattern/</id>
    <published>2017-10-11T13:48:01.000Z</published>
    <updated>2017-10-11T13:48:54.000Z</updated>
    <content type="html"><![CDATA[<p>原文<a href="https://addyosmani.com/resources/essentialjsdesignpatterns/book/#observerpatternjavascript" target="_blank" rel="external">Learning JavaScript Design Patterns</a><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Observer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.update = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">11</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Subject</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.observers = <span class="keyword">new</span> ObserverList();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Subject.prototype.addObserver = <span class="function"><span class="keyword">function</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.observers.add(observer);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Subject.prototype.removeObserver = <span class="function"><span class="keyword">function</span>(<span class="params">observer</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.observers.removeAt(<span class="keyword">this</span>.observers.indexOf(observer, <span class="number">0</span>));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Subject.prototype.notify = <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> observerCount = <span class="keyword">this</span>.observers.count();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; observerCount; i++) &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers.get(i).update(context);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ObserverList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.observerList = [];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ObserverList.prototype.add = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.observerList.push(obj);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ObserverList.prototype.count = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.observerList.length;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ObserverList.prototype.get = <span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (index &gt; -<span class="number">1</span> &amp;&amp; index &lt; <span class="keyword">this</span>.observerList.length) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.observerList[index];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ObserverList.prototype.indexOf = <span class="function"><span class="keyword">function</span>(<span class="params">obj, startIndex</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i = startIndex;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (i &lt; <span class="keyword">this</span>.observerList.length) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.observerList[i] === obj) &#123;</span><br><span class="line">      <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">    i++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ObserverList.prototype.removeAt = <span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.observerList.splice(index, <span class="number">1</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Subjectobj = <span class="keyword">new</span> Subject();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Concrete Observer</span></span><br><span class="line"><span class="keyword">var</span> observer = <span class="keyword">new</span> Observer();</span><br><span class="line">observer.update = <span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Subjectobj.addObserver(observer);</span><br><span class="line"></span><br><span class="line">Subjectobj.notify(<span class="string">"notify"</span>);</span><br><span class="line">Subjectobj.notify(<span class="string">"notify~~~~~~~~~~"</span>);</span><br></pre></td></tr></table></figure></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>原文<a href="https://addyosmani.com/resources/essentialjsdesignpatterns/book/#observerpatternjavascript" target="_blank" rel="external">Lea]]>
    </summary>
    
      <category term="observer pattern" scheme="https://annilq.github.io/tags/observer-pattern/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[简单的promise实现]]></title>
    <link href="https://annilq.github.io/2017/10/11/Promise/"/>
    <id>https://annilq.github.io/2017/10/11/Promise/</id>
    <published>2017-10-11T13:40:01.000Z</published>
    <updated>2017-10-11T13:53:16.000Z</updated>
    <content type="html"><![CDATA[<p><a href="https://medium.com/gitconnected/understand-javascript-promises-by-building-a-promise-from-scratch-84c0fd855720" target="_blank" rel="external">Learn JavaScript Promises by Building a Promise from Scratch</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PromiseSimple</span> </span>&#123;</span><br><span class="line">  constructor(executionFunction) &#123;</span><br><span class="line">    <span class="keyword">this</span>.promiseChain = [];</span><br><span class="line">    <span class="keyword">this</span>.handleError = () =&gt; &#123;&#125;;</span><br><span class="line">    <span class="keyword">this</span>.onResolve = <span class="keyword">this</span>.onResolve.bind(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">this</span>.onReject = <span class="keyword">this</span>.onReject.bind(<span class="keyword">this</span>);</span><br><span class="line">    executionFunction(<span class="keyword">this</span>.onResolve, <span class="keyword">this</span>.onReject);</span><br><span class="line">  &#125;</span><br><span class="line">  then(onResolve) &#123;</span><br><span class="line">    <span class="keyword">this</span>.promiseChain.push(onResolve);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span>(handleError) &#123;</span><br><span class="line">    <span class="keyword">this</span>.handleError = handleError;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  onResolve(value) &#123;</span><br><span class="line">    <span class="keyword">let</span> storedValue = value;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.promiseChain.forEach(nextFunction =&gt; &#123;</span><br><span class="line">        storedValue = nextFunction(storedValue);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">this</span>.promiseChain = [];</span><br><span class="line">      <span class="keyword">this</span>.onReject(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  onReject(error) &#123;</span><br><span class="line">    <span class="keyword">this</span>.handleError(error);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">fakeApiBackend</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> user = &#123;</span><br><span class="line">      username: <span class="string">"treyhuffine"</span>,</span><br><span class="line">      favoriteNumber: <span class="number">42</span>,</span><br><span class="line">      profile: <span class="string">"https://gitconnected.com/treyhuffine"</span></span><br><span class="line">    &#125;; <span class="comment">// Introduce a randomizer to simulate the // the probability of encountering an error</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &gt; <span class="number">0.05</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; data: user, statusCode: <span class="number">200</span> &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> error = &#123;</span><br><span class="line">        statusCode: <span class="number">404</span>,</span><br><span class="line">        message: <span class="string">"Could not find user"</span>,</span><br><span class="line">        error: <span class="string">"Not Found"</span></span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">return</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="keyword">const</span> makeApiCall = () =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> PromiseSimple((resolve, reject) =&gt; &#123;</span><br><span class="line">    setTimeout(</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> apiResponse = <span class="keyword">this</span>.fakeApiBackend();</span><br><span class="line">        <span class="keyword">if</span> (apiResponse.statusCode &gt;= <span class="number">400</span>) &#123;</span><br><span class="line">          reject(apiResponse);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          resolve(apiResponse.data);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="number">5000</span></span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line">makeApiCall()</span><br><span class="line">  .then(user =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"In the first.then()"</span>);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(user =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(</span><br><span class="line">      <span class="string">`User <span class="subst">$&#123;user.username&#125;</span>'s favorite number is <span class="subst">$&#123;user.favoriteNumber&#125;</span>`</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(user =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"The previous.then() told you the favoriteNumber"</span>);</span><br><span class="line">    <span class="keyword">return</span> user.profile;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(profile =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`The profile URL is <span class="subst">$&#123;profile&#125;</span>`</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(() =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"This is the last then()"</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(error =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error.message);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p><a href="https://medium.com/gitconnected/understand-javascript-promises-by-building-a-promise-from-scratch-84c0fd855720" target="_blank" ]]>
    </summary>
    
      <category term="promise" scheme="https://annilq.github.io/tags/promise/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ES6 iterator generator 小记]]></title>
    <link href="https://annilq.github.io/2017/09/28/generator/"/>
    <id>https://annilq.github.io/2017/09/28/generator/</id>
    <published>2017-09-28T13:10:01.000Z</published>
    <updated>2017-11-29T12:34:25.000Z</updated>
    <content type="html"><![CDATA[<ol>
<li>每个迭代器对象都有一个next方法，每次调用这个方法都返回一个含有<code>{done,value}</code>属性的对象</li>
<li>生成器是一个返回迭代器对象的函数</li>
<li>可迭代对象具有一个默认迭代器用Symbol.iterator函数属性表示，可以重新定义该函数来添加或者覆盖附属对象的迭代器</li>
<li>数组，Map，Set中内置了三种迭代器<ol>
<li>entries()</li>
<li>values()</li>
<li>keys()</li>
</ol>
</li>
<li>for-of循环每执行一次都会调用可迭代对象的next()方法并将迭代器返回的结果对象的value值存储在一个变量中，指导返回对象的done值为true</li>
</ol>
<h3 id="u8BBF_u95EE_u9ED8_u8BA4_u8FED_u4EE3_u5668"><a href="#u8BBF_u95EE_u9ED8_u8BA4_u8FED_u4EE3_u5668" class="headerlink" title="访问默认迭代器"></a>访问默认迭代器</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">const</span> iterator=arr[<span class="built_in">Symbol</span>.iterator]()</span><br><span class="line"><span class="built_in">console</span>.log(iterator.next());</span><br></pre></td></tr></table></figure>
<h3 id="u8BBE_u7F6E_u8FED_u4EE3_u5668"><a href="#u8BBE_u7F6E_u8FED_u4EE3_u5668" class="headerlink" title="设置迭代器"></a>设置迭代器</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> iter = &#123;</span><br><span class="line">  items: [],</span><br><span class="line">  *[<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> <span class="keyword">this</span>.items) &#123;</span><br><span class="line">      <span class="keyword">yield</span> item;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">iter.items.push(<span class="number">1</span>);</span><br><span class="line">iter.items.push(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> iter) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u8FED_u4EE3_u5668_u5904_u7406_u5F02_u6B65_u95EE_u9898"><a href="#u8FED_u4EE3_u5668_u5904_u7406_u5F02_u6B65_u95EE_u9898" class="headerlink" title="迭代器处理异步问题"></a>迭代器处理异步问题</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理同步</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runsync</span>(<span class="params">gen</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> iter = gen();</span><br><span class="line">  <span class="keyword">var</span> result = iter.next();</span><br><span class="line">  <span class="keyword">while</span> (!result.done) &#123;</span><br><span class="line">    result = iter.next(result.value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 同步genarator</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">sync</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> value = <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(value);</span><br><span class="line">  value = <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(value);</span><br><span class="line">  value = <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理异步promise</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runasygc</span>(<span class="params">gen</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> iter = gen();</span><br><span class="line">  <span class="keyword">var</span> result = iter.next();</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">step</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!result.done) &#123;</span><br><span class="line">      result.value.then(data =&gt; &#123;</span><br><span class="line">        result = iter.next(data);</span><br><span class="line">        step(result);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  step(result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 异步genarator</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">asygc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> value = <span class="keyword">yield</span> timeout(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(value);</span><br><span class="line">  value = <span class="keyword">yield</span> timeout(<span class="number">2</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(value);</span><br><span class="line">  value = <span class="keyword">yield</span> timeout(<span class="number">3</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timeout</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">runsync(sync);</span><br><span class="line">runasygc(sync);</span><br></pre></td></tr></table></figure>
<p>参考</p>
<ol>
<li>深入理解ES6 第八章迭代器与生成器</li>
<li><a href="http://es6.ruanyifeng.com/#docs/generator-async" target="_blank" rel="external">ECMAScript 6 入门 Generator 函数的异步应用</a></li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<ol>
<li>每个迭代器对象都有一个next方法，每次调用这个方法都返回一个含有<code>{done,value}</code>属性的对象</li>
<li>生成器是一个返回迭代器对象的函数</li>
<li>可迭代对象具有一个默认迭代器用Symbol.iterator函数]]>
    </summary>
    
      <category term="generator promise" scheme="https://annilq.github.io/tags/generator-promise/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[建立自己的Redux]]></title>
    <link href="https://annilq.github.io/2017/07/16/build-your-redux/"/>
    <id>https://annilq.github.io/2017/07/16/build-your-redux/</id>
    <published>2017-07-16T00:53:10.000Z</published>
    <updated>2017-07-25T12:00:46.000Z</updated>
    <content type="html"><![CDATA[<p>原文:<a href="https://zapier.com/engineering/how-to-build-redux/" target="_blank" rel="external">Build Yourself a Redux</a></p>
<h3 id="u5148_u6765_u770B_u770B_u6CA1_u6709redux_u6211_u4EEC_u600E_u6837_u5EFA_u7ACB_u5E94_u7528"><a href="#u5148_u6765_u770B_u770B_u6CA1_u6709redux_u6211_u4EEC_u600E_u6837_u5EFA_u7ACB_u5E94_u7528" class="headerlink" title="先来看看没有redux我们怎样建立应用"></a>先来看看没有redux我们怎样建立应用</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">const initialState = &#123;</span><br><span class="line">  nextNoteId: 1,</span><br><span class="line">  notes: &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">window.state = initialState;</span><br><span class="line">const onAddNote = () =&gt; &#123;</span><br><span class="line">  const id = window.state.nextNoteId;</span><br><span class="line">  window.state.notes[id] = &#123;</span><br><span class="line">    id,</span><br><span class="line">    content: ""</span><br><span class="line">  &#125;;</span><br><span class="line">  window.state.nextNoteId++;</span><br><span class="line">  renderApp();</span><br><span class="line">&#125;;</span><br><span class="line">const NoteApp = (&#123; notes &#125;) =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;ul className="note-list"&gt;</span><br><span class="line">      &#123;Object.keys(notes).map(id =&gt; (</span><br><span class="line">        &lt;li className="note-list-item" key=&#123;id&#125;&gt;&#123;id&#125;&lt;/li&gt;</span><br><span class="line">      ))&#125;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">    &lt;button className="editor-button" onClick=&#123;onAddNote&#125;&gt;New Note&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">);</span><br><span class="line">const renderApp = () =&gt; &#123;</span><br><span class="line">  ReactDOM.render(</span><br><span class="line">    &lt;NoteApp notes=&#123;window.state.notes&#125; /&gt;,</span><br><span class="line">    document.getElementById("root")</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line">renderApp();</span><br></pre></td></tr></table></figure>
<p><a href="https://jsfiddle.net/justindeal/5j3can1z/1/?utm_source=website&amp;utm_medium=embed&amp;utm_campaign=5j3can1z" target="_blank" rel="external">jsfiddle</a></p>
<h4 id="u4E0A_u9762_u8FD9_u79CD_u65B9_u5F0F_u5E26_u6765_u7684_u95EE_u9898"><a href="#u4E0A_u9762_u8FD9_u79CD_u65B9_u5F0F_u5E26_u6765_u7684_u95EE_u9898" class="headerlink" title="上面这种方式带来的问题"></a>上面这种方式带来的问题</h4><ol>
<li>任何地方都可以渲染组件,每次state改变都要调用renderApp，会导致UI的故障或者无响应</li>
<li>流程判断条件可能定义在自不同地方</li>
<li>无法测试代码，必须要记住整个应用的state才行</li>
<li>如果出bug了很难定位</li>
</ol>
<p>最后重要的一点是如果你想缩小你的app功能，你可能要改很多地方</p>
<h3 id="u73B0_u5728_u51C6_u5907_u5EFA_u7ACB_u81EA_u5DF1_u7684Redux"><a href="#u73B0_u5728_u51C6_u5907_u5EFA_u7ACB_u81EA_u5DF1_u7684Redux" class="headerlink" title="现在准备建立自己的Redux"></a>现在准备建立自己的Redux</h3><p>redux 涉及的三个概念</p>
<ol>
<li>reducer</li>
<li>store(state)</li>
<li>action</li>
</ol>
<h4 id="1-__u5148_u770B_u770BReducer"><a href="#1-__u5148_u770B_u770BReducer" class="headerlink" title="1. 先看看Reducer"></a>1. 先看看Reducer</h4><ol>
<li>reducer函数接收一个state和action，返回一个新的state</li>
<li>reducer是一个纯函数<br>使用reducer<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reducer = (state = initialState, action) =&gt; &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> CREATE_NOTE: &#123;</span><br><span class="line">      <span class="comment">// DO NOT MUTATE STATE LIKE THIS!!!</span></span><br><span class="line">      state.notes[state.nextNoteId] = &#123;</span><br><span class="line">        id: state.nextNoteId,</span><br><span class="line">        content: <span class="string">""</span></span><br><span class="line">      &#125;;</span><br><span class="line">      state.nextNoteId++;</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> UPDATE_NOTE: &#123;</span><br><span class="line">      <span class="comment">// DO NOT MUTATE STATE LIKE THIS!!!</span></span><br><span class="line">      state.notes[action.id].content = action.content;</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> state0 = reducer(<span class="literal">undefined</span>, &#123;</span><br><span class="line">  type: CREATE_NOTE</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   nextNoteId: 2,</span></span><br><span class="line"><span class="comment">//   notes: &#123;</span></span><br><span class="line"><span class="comment">//     1: &#123;</span></span><br><span class="line"><span class="comment">//       id: 1,</span></span><br><span class="line"><span class="comment">//       content: ''</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="keyword">const</span> state1  = reducer(state0, &#123;</span><br><span class="line">  type: UPDATE_NOTE,</span><br><span class="line">  id: <span class="number">1</span>,</span><br><span class="line">  content: <span class="string">'Hello, world!'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   nextNoteId: 2,</span></span><br><span class="line"><span class="comment">//   notes: &#123;</span></span><br><span class="line"><span class="comment">//     1: &#123;</span></span><br><span class="line"><span class="comment">//       id: 1,</span></span><br><span class="line"><span class="comment">//       content: 'Hello, world!'</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>上面就是redux的核心代码，一个函数接收一个state和action，返回一个新的state，至于为什么要叫reducer，因为他可以直接用于reduce function中<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> actions = [</span><br><span class="line">  &#123;type: CREATE_NOTE&#125;,</span><br><span class="line">  &#123;type: UPDATE_NOTE, id: <span class="number">1</span>, content: <span class="string">'Hello, world!'</span>&#125;</span><br><span class="line">];</span><br><span class="line"><span class="keyword">const</span> state = actions.reduce(reducer, <span class="literal">undefined</span>);</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   nextNoteId: 2,</span></span><br><span class="line"><span class="comment">//   notes: &#123;</span></span><br><span class="line"><span class="comment">//     1: &#123;</span></span><br><span class="line"><span class="comment">//       id: 1,</span></span><br><span class="line"><span class="comment">//       content: 'Hello, world!'</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="2-__u518D_u6765_u770B_u770Bstore"><a href="#2-__u518D_u6765_u770B_u770Bstore" class="headerlink" title="2. 再来看看store"></a>2. 再来看看store</h4><p>store 会保存我们的state并且还有一些设置和获取state的方法<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> validateAction = action =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!action || <span class="keyword">typeof</span> action !== <span class="string">'object'</span> || <span class="built_in">Array</span>.isArray(action)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Action must be an object!'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> action.type === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Action must have a type!'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> createStore = (reducer) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> state = <span class="literal">undefined</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    dispatch: (action) =&gt; &#123;</span><br><span class="line">      validateAction(action)</span><br><span class="line">      state = reducer(state, action);</span><br><span class="line">    &#125;,</span><br><span class="line">    getState: () =&gt; state</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>现在我们使用一下store<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pass in the reducer we made earlier.</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer);</span><br><span class="line">store.dispatch(&#123;</span><br><span class="line">  type: CREATE_NOTE</span><br><span class="line">&#125;);</span><br><span class="line">store.getState();</span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//   nextNoteId: 2,</span></span><br><span class="line"><span class="comment">//   notes: &#123;</span></span><br><span class="line"><span class="comment">//     1: &#123;</span></span><br><span class="line"><span class="comment">//       id: 1,</span></span><br><span class="line"><span class="comment">//       content: ''</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure></p>
<p>它仍然缺少一个重要的一点：一种订阅更改的方法。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createStore = reducer =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> state;</span><br><span class="line">  <span class="keyword">const</span> subscribers = [];</span><br><span class="line">  <span class="keyword">const</span> store = &#123;</span><br><span class="line">    dispatch: action =&gt; &#123;</span><br><span class="line">      validateAction(action);</span><br><span class="line">      state = reducer(state, action);</span><br><span class="line">      subscribers.forEach(handler =&gt; handler());</span><br><span class="line">    &#125;,</span><br><span class="line">    getState: () =&gt; state,</span><br><span class="line">    subscribe: handler =&gt; &#123;</span><br><span class="line">      subscribers.push(handler);</span><br><span class="line">      <span class="keyword">return</span> () =&gt; &#123;</span><br><span class="line">        <span class="comment">// for unsubcribe</span></span><br><span class="line">        <span class="keyword">const</span> index = subscribers.indexOf(handler);</span><br><span class="line">        <span class="keyword">if</span> (index &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          subscribers.splice(index, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  store.dispatch(&#123;type: <span class="string">'@@redux/INIT'</span>&#125;);</span><br><span class="line">  <span class="keyword">return</span> store;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p><a href="https://jsfiddle.net/justindeal/8cpu4ydj/3/?utm_source=website&amp;utm_medium=embed&amp;utm_campaign=8cpu4ydj" target="_blank" rel="external">jsfiddle demo</a></p>
<h4 id="3-__u56DE_u60F3_u4E0B_u4F60_u662F_u600E_u6837_u7528redux_u7684_uFF0C_u5927_u6982_u662F_u4E0B_u9762_u8FD9_u6837_u5427"><a href="#3-__u56DE_u60F3_u4E0B_u4F60_u662F_u600E_u6837_u7528redux_u7684_uFF0C_u5927_u6982_u662F_u4E0B_u9762_u8FD9_u6837_u5427" class="headerlink" title="3. 回想下你是怎样用redux的，大概是下面这样吧"></a>3. 回想下你是怎样用redux的，大概是下面这样吧</h4><ol>
<li>首先定义一个pure component</li>
<li>然后为他再包装一个container<br>我们自己定义的redux是将store传到container中，再将方法传递下去</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></td><td class="code"><pre><span class="line">const validateAction = action =&gt; &#123;</span><br><span class="line">  if (!action || typeof action !== 'object' || Array.isArray(action)) &#123;</span><br><span class="line">    throw new Error('Action must be an object!');</span><br><span class="line">  &#125;</span><br><span class="line">  if (typeof action.type === 'undefined') &#123;</span><br><span class="line">    throw new Error('Action must have a type!');</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const createStore = reducer =&gt; &#123;</span><br><span class="line">  let state;</span><br><span class="line">  const subscribers = [];</span><br><span class="line">  const store = &#123;</span><br><span class="line">    dispatch: action =&gt; &#123;</span><br><span class="line">      validateAction(action);</span><br><span class="line">      state = reducer(state, action);</span><br><span class="line">      subscribers.forEach(handler =&gt; handler());</span><br><span class="line">    &#125;,</span><br><span class="line">    getState: () =&gt; state,</span><br><span class="line">    subscribe: handler =&gt; &#123;</span><br><span class="line">      subscribers.push(handler);</span><br><span class="line">      return () =&gt; &#123;</span><br><span class="line">        const index = subscribers.indexOf(handler);</span><br><span class="line">        if (index &gt; 0) &#123;</span><br><span class="line">          subscribers.splice(index, 1);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  store.dispatch(&#123;type: '@@redux/INIT'&#125;);</span><br><span class="line">  return store;</span><br><span class="line">&#125;;</span><br><span class="line">//////////////////////</span><br><span class="line">// Our action types //</span><br><span class="line">//////////////////////</span><br><span class="line">const CREATE_NOTE = 'CREATE_NOTE';</span><br><span class="line">const UPDATE_NOTE = 'UPDATE_NOTE';</span><br><span class="line">const OPEN_NOTE = 'OPEN_NOTE';</span><br><span class="line">const CLOSE_NOTE = 'CLOSE_NOTE';</span><br><span class="line">/////////////////</span><br><span class="line">// Our reducer //</span><br><span class="line">/////////////////</span><br><span class="line">const initialState = &#123;</span><br><span class="line">  nextNoteId: 1,</span><br><span class="line">  notes: &#123;&#125;,</span><br><span class="line">  openNoteId: null</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const reducer = (state = initialState, action) =&gt; &#123;</span><br><span class="line">  switch (action.type) &#123;</span><br><span class="line">    case CREATE_NOTE: &#123;</span><br><span class="line">      const id = state.nextNoteId;</span><br><span class="line">      const newNote = &#123;</span><br><span class="line">        id,</span><br><span class="line">        content: ''</span><br><span class="line">      &#125;;</span><br><span class="line">      return &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        nextNoteId: id + 1,</span><br><span class="line">        openNoteId: id,</span><br><span class="line">        notes: &#123;</span><br><span class="line">          ...state.notes,</span><br><span class="line">          [id]: newNote</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    case UPDATE_NOTE: &#123;</span><br><span class="line">      const &#123;id, content&#125; = action;</span><br><span class="line">      const editedNote = &#123;</span><br><span class="line">        ...state.notes[id],</span><br><span class="line">        content</span><br><span class="line">      &#125;;</span><br><span class="line">      return &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        notes: &#123;</span><br><span class="line">          ...state.notes,</span><br><span class="line">          [id]: editedNote</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    case OPEN_NOTE: &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        openNoteId: action.id</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    case CLOSE_NOTE: &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        openNoteId: null</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    default:</span><br><span class="line">      return state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">///////////////</span><br><span class="line">// Our store //</span><br><span class="line">///////////////</span><br><span class="line">const store = createStore(reducer);</span><br><span class="line">////////////////////</span><br><span class="line">// Our components //</span><br><span class="line">////////////////////</span><br><span class="line"></span><br><span class="line">const NoteEditor = (&#123;note, onChangeNote, onCloseNote&#125;) =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;textarea</span><br><span class="line">        className="editor-content"</span><br><span class="line">        autoFocus</span><br><span class="line">        value=&#123;note.content&#125;</span><br><span class="line">        onChange=&#123;event =&gt;</span><br><span class="line">          onChangeNote(note.id, event.target.value)</span><br><span class="line">        &#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;button className="editor-button" onClick=&#123;onCloseNote&#125;&gt;</span><br><span class="line">      Close</span><br><span class="line">    &lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">);</span><br><span class="line">const NoteTitle = (&#123;note&#125;) =&gt; &#123;</span><br><span class="line">  const title = note.content</span><br><span class="line">    .split('\n')[0].replace(/^\s+|\s+$/g, '');</span><br><span class="line">  if (title === '') &#123;</span><br><span class="line">    return &lt;i&gt;Untitled&lt;/i&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">  return &lt;span&gt;&#123;title&#125;&lt;/span&gt;;</span><br><span class="line">&#125;;</span><br><span class="line">const NoteLink = (&#123;note, onOpenNote&#125;) =&gt; (</span><br><span class="line">  &lt;li className="note-list-item"&gt;</span><br><span class="line">    &lt;a href="#" onClick=&#123;() =&gt; onOpenNote(note.id)&#125;&gt;</span><br><span class="line">      &lt;NoteTitle note=&#123;note&#125;/&gt;</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">);</span><br><span class="line">const NoteList = (&#123;notes, onOpenNote&#125;) =&gt; (</span><br><span class="line">  &lt;ul className="note-list"&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      Object.keys(notes).map(id =&gt;</span><br><span class="line">        &lt;NoteLink</span><br><span class="line">          key=&#123;id&#125;</span><br><span class="line">          note=&#123;notes[id]&#125;</span><br><span class="line">          onOpenNote=&#123;onOpenNote&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">);</span><br><span class="line">const NoteApp = (&#123;</span><br><span class="line">  notes, openNoteId, onAddNote, onChangeNote,</span><br><span class="line">  onOpenNote, onCloseNote</span><br><span class="line">&#125;) =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      openNoteId ?</span><br><span class="line">        &lt;NoteEditor</span><br><span class="line">          note=&#123;notes[openNoteId]&#125;</span><br><span class="line">          onChangeNote=&#123;onChangeNote&#125;</span><br><span class="line">          onCloseNote=&#123;onCloseNote&#125;</span><br><span class="line">        /&gt; :</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;NoteList</span><br><span class="line">            notes=&#123;notes&#125;</span><br><span class="line">            onOpenNote=&#123;onOpenNote&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &#123;</span><br><span class="line">            &lt;button</span><br><span class="line">              className="editor-button"</span><br><span class="line">              onClick=&#123;onAddNote&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              New Note</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">          &#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">);</span><br><span class="line">class NoteAppContainer extends React.Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super();</span><br><span class="line">    this.state = props.store.getState();</span><br><span class="line">    this.onAddNote = this.onAddNote.bind(this);</span><br><span class="line">    this.onChangeNote = this.onChangeNote.bind(this);</span><br><span class="line">    this.onOpenNote = this.onOpenNote.bind(this);</span><br><span class="line">    this.onCloseNote = this.onCloseNote.bind(this);</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillMount() &#123;</span><br><span class="line">    this.unsubscribe = this.props.store.subscribe(() =&gt;</span><br><span class="line">      this.setState(this.props.store.getState())</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  componentWillUnmount() &#123;</span><br><span class="line">    this.unsubscribe();</span><br><span class="line">  &#125;</span><br><span class="line">  onAddNote() &#123;</span><br><span class="line">    this.props.store.dispatch(&#123;</span><br><span class="line">      type: CREATE_NOTE</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  onChangeNote(id, content) &#123;</span><br><span class="line">    this.props.store.dispatch(&#123;</span><br><span class="line">      type: UPDATE_NOTE,</span><br><span class="line">      id,</span><br><span class="line">      content</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  onOpenNote(id) &#123;</span><br><span class="line">    this.props.store.dispatch(&#123;</span><br><span class="line">      type: OPEN_NOTE,</span><br><span class="line">      id</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  onCloseNote() &#123;</span><br><span class="line">    this.props.store.dispatch(&#123;</span><br><span class="line">      type: CLOSE_NOTE</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;NoteApp</span><br><span class="line">        &#123;...this.state&#125;</span><br><span class="line">        onAddNote=&#123;this.onAddNote&#125;</span><br><span class="line">        onChangeNote=&#123;this.onChangeNote&#125;</span><br><span class="line">        onOpenNote=&#123;this.onOpenNote&#125;</span><br><span class="line">        onCloseNote=&#123;this.onCloseNote&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;NoteAppContainer store=&#123;store&#125;/&gt;,</span><br><span class="line">  document.getElementById('root')</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ol>
<li>将store与component连接起来</li>
<li>container里面做了很多重复的工作（subscribe,unsubscribe,function binding)</li>
<li>每次都会用到全局的store都要传递</li>
</ol>
<h4 id="u73B0_u5728_u6211_u4EEC_u8BD5_u8BD5_u5B9E_u73B0_u4E00_u4E2Aredux_u7684provider"><a href="#u73B0_u5728_u6211_u4EEC_u8BD5_u8BD5_u5B9E_u73B0_u4E00_u4E2Aredux_u7684provider" class="headerlink" title="现在我们试试实现一个redux的provider"></a>现在我们试试实现一个redux的provider</h4><p>Provider组件使用React的上下文功能将storeprop转换为context属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Provider</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  getChildContext() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      store: <span class="keyword">this</span>.props.store</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.props.children;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Provider.childContextTypes = &#123;</span><br><span class="line">  store: PropTypes.object</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>有了store，下面用connect函数我们把context上面的props传递到组件中<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> connect = (</span><br><span class="line">  mapStateToProps = () =&gt; (&#123;&#125;),</span><br><span class="line">  mapDispatchToProps = () =&gt; (&#123;&#125;)</span><br><span class="line">) =&gt; Component =&gt; &#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Connected</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    onStoreOrPropsChange(props) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;store&#125; = <span class="keyword">this</span>.context;</span><br><span class="line">      <span class="keyword">const</span> state = store.getState();</span><br><span class="line">      <span class="keyword">const</span> stateProps = mapStateToProps(state, props);</span><br><span class="line">      <span class="keyword">const</span> dispatchProps = mapDispatchToProps(store.dispatch, props);</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        ...stateProps,</span><br><span class="line">        ...dispatchProps</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillMount() &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;store&#125; = <span class="keyword">this</span>.context;</span><br><span class="line">      <span class="keyword">this</span>.onStoreOrPropsChange(<span class="keyword">this</span>.props);</span><br><span class="line">      <span class="keyword">this</span>.unsubscribe = store.subscribe(() =&gt; <span class="keyword">this</span>.onStoreOrPropsChange(<span class="keyword">this</span>.props));</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">      <span class="keyword">this</span>.onStoreOrPropsChange(nextProps);</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line">      <span class="keyword">this</span>.unsubscribe();</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="title">Component</span> &#123;<span class="attribute">...this.props</span>&#125; &#123;<span class="attribute">...this.state</span>&#125;/&gt;</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Connected.contextTypes = &#123;</span><br><span class="line">    store: PropTypes.object</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> Connected;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol>
<li>connect函数接收两个参数mapStateToProps，mapDispatchToProps，返回一个新的函数</li>
<li>新的函数使用带包装的子组件作为参数，将子组件需要的state以及dispatch，作为当前组件的state</li>
<li>将当前组件的state作为props传递给需要包装的子组件</li>
</ol>
<p><a href="https://jsfiddle.net/justindeal/o27j5zs1/1/?utm_source=website&amp;utm_medium=embed&amp;utm_campaign=o27j5zs1" target="_blank" rel="external">fiddle demo</a></p>
<h4 id="u4E2D_u95F4_u4EF6"><a href="#u4E2D_u95F4_u4EF6" class="headerlink" title="中间件"></a>中间件</h4><p>目前我们的redux还不能应付异步action的问题，利用中间件可以解决这个问题，加载单个中间件的代码如下所示<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createStore = (reducer, middleware) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> state;</span><br><span class="line">  <span class="keyword">const</span> subscribers = [];</span><br><span class="line">  <span class="keyword">const</span> coreDispatch = action =&gt; &#123;</span><br><span class="line">    validateAction(action);</span><br><span class="line">    state = reducer(state, action);</span><br><span class="line">    subscribers.forEach(handler =&gt; handler());</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> getState = () =&gt; state;</span><br><span class="line">  <span class="keyword">const</span> store = &#123;</span><br><span class="line">    dispatch: coreDispatch,</span><br><span class="line">    getState,</span><br><span class="line">    subscribe: handler =&gt; &#123;</span><br><span class="line">      subscribers.push(handler);</span><br><span class="line">      <span class="keyword">return</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> index = subscribers.indexOf(handler)</span><br><span class="line">        <span class="keyword">if</span> (index &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          subscribers.splice(index, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="comment">// 判断时候有中间件</span></span><br><span class="line">  <span class="keyword">if</span> (middleware) &#123;</span><br><span class="line">    <span class="keyword">const</span> dispatch = action =&gt; store.dispatch(action);</span><br><span class="line"><span class="comment">// 实际执行顺序是当store.dispatch 被调用的时候先执行中间件里面的内容，执行之后再dispatch action</span></span><br><span class="line">    store.dispatch = middleware(&#123;</span><br><span class="line">      dispatch,</span><br><span class="line">      getState</span><br><span class="line">    &#125;)(coreDispatch);</span><br><span class="line">  &#125;</span><br><span class="line">  coreDispatch(&#123;type: <span class="string">'@@redux/INIT'</span>&#125;);</span><br><span class="line">  <span class="keyword">return</span> store;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>thunkMiddleware<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> thunkMiddleware = (&#123;dispatch, getState&#125;) =&gt; next =&gt; action =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> action === <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> action(&#123;dispatch, getState&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> next(action);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>ps:上面关于中间件代码不是很好理解可以参考<br><a href="https://zhuanlan.zhihu.com/p/21391101" target="_blank" rel="external">理解 redux 中间件</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>原文:<a href="https://zapier.com/engineering/how-to-build-redux/" target="_blank" rel="external">Build Yourself a Redux</a></p>
<h3 id="u51]]>
    </summary>
    
      <category term="Redux" scheme="https://annilq.github.io/tags/Redux/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[用 flask 创建 todo api]]></title>
    <link href="https://annilq.github.io/2017/07/08/python-todo/"/>
    <id>https://annilq.github.io/2017/07/08/python-todo/</id>
    <published>2017-07-08T15:44:20.000Z</published>
    <updated>2017-07-20T14:37:59.000Z</updated>
    <content type="html"><![CDATA[<h4 id="u521B_u5EFA_u865A_u62DF_u73AF_u5883"><a href="#u521B_u5EFA_u865A_u62DF_u73AF_u5883" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h4><ol>
<li><p>创建虚拟环境python-todo-app</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m venv python-todo-app</span><br></pre></td></tr></table></figure>
</li>
<li><p>进入python-todo-server并在当前目录激活环境(退出环境命令<code>deactivate</code>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ./bin/activate</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><a href="https://docs.python.org/3/library/venv.html" target="_blank" rel="external">用venv安装虚拟环境</a></p>
<h4 id="u5B89_u88C5_u9879_u76EE_u4F9D_u8D56"><a href="#u5B89_u88C5_u9879_u76EE_u4F9D_u8D56" class="headerlink" title="安装项目依赖"></a>安装项目依赖</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pip install Flask</span><br><span class="line">pip install Flask-PyMongo</span><br><span class="line">pip install flask-restful</span><br><span class="line"><span class="comment">## 记录第三方模块</span></span><br><span class="line">pip freeze &gt; requirements.txt</span><br><span class="line"><span class="comment">## 安装txt文件里所记录的所有第三方模块</span></span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>
<h4 id="u5E94_u7528_u90E8_u5206"><a href="#u5E94_u7528_u90E8_u5206" class="headerlink" title="应用部分"></a>应用部分</h4><p>项目d地址<a href="https://github.com/annilq/python-todo-server" target="_blank" rel="external">python-todo-server</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h4 id="u521B_u5EFA_u865A_u62DF_u73AF_u5883"><a href="#u521B_u5EFA_u865A_u62DF_u73AF_u5883" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h4]]>
    </summary>
    
      <category term="python flask" scheme="https://annilq.github.io/tags/python-flask/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ES6 async／await 小记]]></title>
    <link href="https://annilq.github.io/2017/07/02/async/"/>
    <id>https://annilq.github.io/2017/07/02/async/</id>
    <published>2017-07-02T13:48:01.000Z</published>
    <updated>2017-09-28T13:10:20.000Z</updated>
    <content type="html"><![CDATA[<p>async await 基于promise</p>
<ol>
<li>async function 创建之后立即返回一个promise对象</li>
<li>await 关键字只能在async function 中，后面跟着的操作的返回值可以是promise对象也可以是原始值,如果事原始值等于事同步操作</li>
<li>async function return的值等于async function返回的promise对象resolve的值</li>
<li>互相不依赖的async function可以用promise.all来将所有的操作一起await<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 同步操作</span></span><br><span class="line"><span class="keyword">var</span> sleep = <span class="function"><span class="keyword">function</span>(<span class="params">para</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> para + <span class="number">2</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 异步操作</span></span><br><span class="line"><span class="keyword">var</span> sleep2 = <span class="function"><span class="keyword">function</span>(<span class="params">para</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    setTimeout(</span><br><span class="line">      <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        resolve(para * para);</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="number">2000</span></span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 互相依赖</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncSleep</span>(<span class="params">para</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result1 = <span class="keyword">await</span> sleep(para);</span><br><span class="line">  <span class="keyword">var</span> result2 = <span class="keyword">await</span> sleep2(result1);</span><br><span class="line">  <span class="keyword">var</span> result3 = <span class="keyword">await</span> sleep2(result2);</span><br><span class="line">  <span class="keyword">return</span> result3;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 互相不依赖的function</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">asyncSleep2</span>(<span class="params">para</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result1 = <span class="keyword">await</span> sleep(para);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span> <span class="built_in">Promise</span>.all([sleep2(result1), sleep2(<span class="number">2</span>)]);</span><br><span class="line">&#125;</span><br><span class="line">asyncSleep(<span class="number">2</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">result2</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//result2 is 256</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"asyncSleep"</span>, result2);</span><br><span class="line">&#125;);</span><br><span class="line">asyncSleep2(<span class="number">2</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">[result, result2]</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//16 4</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"asyncSleep2"</span>, result, result2);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>参考链接<br><a href="http://es6.ruanyifeng.com/#docs/async" target="_blank" rel="external">ECMAScript 6 入门 async 函数</a><br><a href="https://hackernoon.com/6-reasons-why-javascripts-async-await-blows-promises-away-tutorial-c7ec10518dd9" target="_blank" rel="external">6 Reasons Why JavaScript’s Async/Await Blows Promises Away</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>async await 基于promise</p>
<ol>
<li>async function 创建之后立即返回一个promise对象</li>
<li>await 关键字只能在async function 中，后面跟着的操作的返回值可以是promise对象也可以是原始]]>
    </summary>
    
      <category term="async await promise" scheme="https://annilq.github.io/tags/async-await-promise/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[MongoDB小记]]></title>
    <link href="https://annilq.github.io/2017/05/19/mongoDb/"/>
    <id>https://annilq.github.io/2017/05/19/mongoDb/</id>
    <published>2017-05-19T15:45:48.000Z</published>
    <updated>2017-05-19T15:45:48.000Z</updated>
    <content type="html"><![CDATA[<h3 id="Install_MongoDB_with_Homebrew"><a href="#Install_MongoDB_with_Homebrew" class="headerlink" title="Install MongoDB with Homebrew"></a>Install MongoDB with Homebrew</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew <span class="operator"><span class="keyword">install</span> mongodb</span><br><span class="line">mkdir -<span class="keyword">p</span> /<span class="keyword">data</span>/db</span></span><br></pre></td></tr></table></figure>
<h3 id="Set_permissions_for_the_data_directory"><a href="#Set_permissions_for_the_data_directory" class="headerlink" title="Set permissions for the data directory"></a>Set permissions for the data directory</h3><p>Ensure that user account running mongod has correct permissions for the directory:</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod <span class="number">0755</span> /data/db</span><br><span class="line">sudo chown <span class="variable">$USER</span> /data/db</span><br></pre></td></tr></table></figure>
<h3 id="start_mongodb_service_to_running_on_the_mac"><a href="#start_mongodb_service_to_running_on_the_mac" class="headerlink" title="start mongodb service to running on the mac."></a>start mongodb service to running on the mac.</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span>services start mongodb</span><br></pre></td></tr></table></figure>
<p><a href="http://stackoverflow.com/questions/5596521/what-is-the-correct-way-to-start-a-mongod-service-on-linux-os-x" target="_blank" rel="external">参考链接</a></p>
<h4 id="window_u4E0B_u9762_u5B89_u88C5mongodb"><a href="#window_u4E0B_u9762_u5B89_u88C5mongodb" class="headerlink" title="window下面安装mongodb"></a>window下面安装mongodb</h4><p>参考链接<a href="https://jingyan.baidu.com/article/d5c4b52bef7268da560dc5f8.html" target="_blank" rel="external">windows下MongoDB的安装及配置</a></p>
<ol>
<li>下载mongodb并安装比如d:/mongodb/,并加入到path</li>
<li>创建数据库文件的存放位置，比如d:/mongodb/data/db</li>
<li>手动开启mongo服务mongod –dbpath D:\mongodb\data\db</li>
<li>设置windows服务开机自启动<ol>
<li>在D:\mongodb\data下新建文件夹log（存放日志文件）并且新建文件mongodb.log</li>
<li>在d:\mongodb新建文件mongo.config并输入<ol>
<li>dbpath=D:\mongodb\data\db</li>
<li>logpath=D:\mongodb\data\log\mongo.log</li>
<li>输入mongod –config D:\mongodb\mongo.config –install –serviceName “MongoDB” 将mongo服务加入到启动项</li>
<li>打开cmd输入services.msc查看服务可以看到MongoDB服务，点击启动并设置自动。</li>
</ol>
</li>
</ol>
</li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="Install_MongoDB_with_Homebrew"><a href="#Install_MongoDB_with_Homebrew" class="headerlink" title="Install MongoDB with Homebrew"></a]]>
    </summary>
    
      <category term="MongoDB" scheme="https://annilq.github.io/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[nodejs小记]]></title>
    <link href="https://annilq.github.io/2017/04/09/nodejs/"/>
    <id>https://annilq.github.io/2017/04/09/nodejs/</id>
    <published>2017-04-09T15:05:01.000Z</published>
    <updated>2017-11-29T12:34:25.000Z</updated>
    <content type="html"><![CDATA[<h3 id="u4E0B_u9762_u662F_u4E00_u4E2A_u5BA2_u6237_u7AEF_u53D1_u8D77_u8BF7_u6C42_u670D_u52A1_u5668_u54CD_u5E94_u8BF7_u6C42_u7684_u6848_u4F8B"><a href="#u4E0B_u9762_u662F_u4E00_u4E2A_u5BA2_u6237_u7AEF_u53D1_u8D77_u8BF7_u6C42_u670D_u52A1_u5668_u54CD_u5E94_u8BF7_u6C42_u7684_u6848_u4F8B" class="headerlink" title="下面是一个客户端发起请求服务器响应请求的案例"></a>下面是一个客户端发起请求服务器响应请求的案例</h3><p>server.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line">http</span><br><span class="line">  .createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (req.method == <span class="string">"POST"</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"POST"</span>);</span><br><span class="line">      <span class="keyword">var</span> body = <span class="string">""</span>;</span><br><span class="line">      req.on(<span class="string">"data"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        body += data;</span><br><span class="line">        <span class="built_in">console</span>.log(body);</span><br><span class="line">      &#125;);</span><br><span class="line">      req.on(<span class="string">"end"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Body: "</span> + body);</span><br><span class="line">        res.writeHead(<span class="number">200</span>, &#123; <span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span> &#125;);</span><br><span class="line">        res.end(body);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"GET"</span>);</span><br><span class="line">      res.writeHead(<span class="number">200</span>, &#123; <span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span> &#125;);</span><br><span class="line">      res.end(<span class="string">"get"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .listen(<span class="number">3000</span>, <span class="string">"127.0.0.1"</span>);</span><br></pre></td></tr></table></figure></p>
<p>client.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> querystring = <span class="built_in">require</span>(<span class="string">"querystring"</span>);</span><br><span class="line"><span class="keyword">var</span> data = &#123; name: <span class="string">"annilq"</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">  hostname: <span class="string">"127.0.0.1"</span>,</span><br><span class="line">  port: <span class="number">3000</span>,</span><br><span class="line">  method: <span class="string">"POST"</span>,</span><br><span class="line">  path: <span class="string">"/"</span>,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    <span class="string">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span>,</span><br><span class="line">    <span class="string">"Content-Length"</span>: Buffer.byteLength(querystring.stringify(data))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> req = http.request(options, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"statusCode"</span>, res.statusCode);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"header"</span>, <span class="built_in">JSON</span>.stringify(res.headers));</span><br><span class="line">  <span class="keyword">var</span> body = <span class="string">""</span>;</span><br><span class="line">  res.setEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">  res.on(<span class="string">"data"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    body += data;</span><br><span class="line">  &#125;);</span><br><span class="line">  res.on(<span class="string">"end"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(body);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">req.end(querystring.stringify(data));</span><br></pre></td></tr></table></figure></p>
<h3 id="u65B9_u6CD5_u8BF4_u660E"><a href="#u65B9_u6CD5_u8BF4_u660E" class="headerlink" title="方法说明"></a>方法说明</h3><ol>
<li><p>Buffer.byteLength方法返回字符串实际占据的字节长度，默认编码方式为utf8。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Buffer.<span class="function"><span class="title">byteLength</span><span class="params">(<span class="string">'Hello'</span>, <span class="string">'utf8'</span>)</span></span> <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>对象格式化成参数字符串 ,obj就是要格式化的对象,必选参数. [sep]指分隔符 默认&amp; , [eq]指分配符 默认=</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">querystring.<span class="function"><span class="title">stringify</span><span class="params">(obj, [sep], [eq])</span></span></span><br><span class="line">querystring.<span class="function"><span class="title">stringify</span><span class="params">(&#123; foo: <span class="string">'bar'</span>, baz: [<span class="string">'qux'</span>, <span class="string">'quux'</span>], corge: <span class="string">''</span> &#125;)</span></span></span><br><span class="line"><span class="comment">// returns 'foo=bar&amp;baz=qux&amp;baz=quux&amp;corge='</span></span><br><span class="line">querystring.<span class="function"><span class="title">stringify</span><span class="params">(&#123;foo: <span class="string">'bar'</span>, baz: <span class="string">'qux'</span>&#125;, <span class="string">';'</span>, <span class="string">':'</span>)</span></span></span><br><span class="line"><span class="comment">// returns 'foo:bar;baz:qux'</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>需要注意的问题</p>
<ol>
<li>server req只有在 client req post 数据时候才能监听到”data” 事件</li>
<li>client headers指定了错误的 content-length时候，server的req的end事件不会触发<blockquote>
<p><a href="https://github.com/nodejs/node-v0.x-archive/issues/4200" target="_blank" rel="external">request ‘end’ event not called if content-length is incorrect</a></p>
</blockquote>
</li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="u4E0B_u9762_u662F_u4E00_u4E2A_u5BA2_u6237_u7AEF_u53D1_u8D77_u8BF7_u6C42_u670D_u52A1_u5668_u54CD_u5E94_u8BF7_u6C42_u7684_u6848_u4F8B"]]>
    </summary>
    
      <category term="nodejs" scheme="https://annilq.github.io/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[js与原生交互]]></title>
    <link href="https://annilq.github.io/2017/03/27/native/"/>
    <id>https://annilq.github.io/2017/03/27/native/</id>
    <published>2017-03-27T12:50:01.000Z</published>
    <updated>2017-03-27T13:09:29.000Z</updated>
    <content type="html"><![CDATA[<p>公司原来的项目是用cordova命令行创建的，页面UI全是web技术画的，目前项目优化将首页以及列表页面用原生重写了，也弃用了之前的cordova架构，但是由于之前页面也需要到与原生交互，我就自己简单写了个方法用来与原生交互<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> NativeUtil = &#123;</span><br><span class="line">  _Callback: &#123;&#125;,</span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * [调用原生方法]</span><br><span class="line">   * @param  &#123;[type]&#125;   name     [原生方法名]</span><br><span class="line">   * @param  &#123;Function&#125; callback [成功之后的回调]</span><br><span class="line">   * @param  &#123;[type]&#125;   param    [原生插件需要的参数]</span><br><span class="line">   * @return [type]              插件返回值</span><br><span class="line">   */</span></span><br><span class="line">  use: <span class="function"><span class="keyword">function</span>(<span class="params">name, callback, param</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> args = [].slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(args);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>[name]) &#123;</span><br><span class="line">      <span class="keyword">if</span> (args.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> callbackId = <span class="keyword">this</span>._genetateId(name);</span><br><span class="line">        <span class="keyword">this</span>._Callback[callbackId] = callback;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (args.length &gt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>[name](callbackId, param);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (args.length == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>[name](callbackId);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (args.length == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>[name]();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   *  生成回调id</span><br><span class="line">   * @param  &#123;[type]&#125; name [调用的原生方法名]</span><br><span class="line">   * @return [type]        [回调id]</span><br><span class="line">   */</span></span><br><span class="line">  _genetateId: <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> callbackId;</span><br><span class="line">    callbackId = name + <span class="string">"CB"</span> + (<span class="string">""</span> + <span class="built_in">Date</span>.now()).slice(-<span class="number">7</span>);</span><br><span class="line">    <span class="keyword">return</span> callbackId;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 用于原生回调的处理方法</span><br><span class="line">   * @param  &#123;[type]&#125; callbackId [每一个回调会有自己id]</span><br><span class="line">   * @param  &#123;[type]&#125; result     [原生返回的结果]</span><br><span class="line">   * @return [type]              [description]</span><br><span class="line">   */</span></span><br><span class="line">  NativeCallback: <span class="function"><span class="keyword">function</span>(<span class="params">callbackId, result</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>._Callback[callbackId]) &#123;</span><br><span class="line">      <span class="keyword">this</span>._Callback[callbackId](result);</span><br><span class="line">      <span class="keyword">delete</span> <span class="keyword">this</span>._Callback[callbackId];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.info(<span class="string">"NativeCallback can't found callbackId"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 选择与上传图片</span><br><span class="line">   * @param  &#123;[type]&#125; callbackId [用于回调]</span><br><span class="line">   * @param  &#123;[type]&#125; num        [可以选几张]</span><br><span class="line">   * @return [type]              [description]</span><br><span class="line">   */</span></span><br><span class="line">  choosePhoto:<span class="function"><span class="keyword">function</span>(<span class="params">callbackId,num</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.jsInterface) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">window</span>.jsInterface.choosePhoto(callbackId,num);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 获取当前应用版本号</span><br><span class="line">   * @return [type] [description]</span><br><span class="line">   */</span></span><br><span class="line">  getAppVersion: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.jsInterface) &#123;</span><br><span class="line">      <span class="keyword">var</span> appversion = <span class="built_in">window</span>.jsInterface.getVersionName();</span><br><span class="line">      <span class="keyword">return</span> appversion;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>调用方式<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*异步调用*/</span></span><br><span class="line">NativeUtil.<span class="keyword">use</span>(</span><br><span class="line">  <span class="string">"choosePhoto"</span>,</span><br><span class="line">  <span class="function"><span class="keyword">function</span><span class="params">(data)</span> </span>&#123;</span><br><span class="line">    console.log(data)</span><br><span class="line">  &#125;,</span><br><span class="line">  num</span><br><span class="line">);</span><br><span class="line"><span class="comment">/*同步调用*/</span></span><br><span class="line"><span class="keyword">var</span> appVersion=NativeUtil.<span class="keyword">use</span>(</span><br><span class="line">  <span class="string">"getAppVersion"</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>公司原来的项目是用cordova命令行创建的，页面UI全是web技术画的，目前项目优化将首页以及列表页面用原生重写了，也弃用了之前的cordova架构，但是由于之前页面也需要到与原生交互，我就自己简单写了个方法用来与原生交互<br><figure class="highli]]>
    </summary>
    
      <category term="js与原生交互" scheme="https://annilq.github.io/tags/js%E4%B8%8E%E5%8E%9F%E7%94%9F%E4%BA%A4%E4%BA%92/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[atom开发环境配置]]></title>
    <link href="https://annilq.github.io/2017/03/22/atom/"/>
    <id>https://annilq.github.io/2017/03/22/atom/</id>
    <published>2017-03-22T12:24:01.000Z</published>
    <updated>2017-03-22T12:24:05.000Z</updated>
    <content type="html"><![CDATA[<h3 id="atom_package"><a href="#atom_package" class="headerlink" title="atom package"></a>atom package</h3><h4 id="u5FC5_u5907"><a href="#u5FC5_u5907" class="headerlink" title="必备"></a>必备</h4><ol>
<li>git-plus</li>
<li>docblockr</li>
<li>minimap</li>
<li>atom-script</li>
<li>prettier-atom</li>
<li>linter</li>
</ol>
<h5 id="u53EF_u9009"><a href="#u53EF_u9009" class="headerlink" title="可选"></a>可选</h5><ol>
<li>atom-react</li>
<li>atom-react-snippets</li>
<li>activate-power-mode</li>
<li>atom-electron-snippets</li>
<li>atom-typescript</li>
<li>atom-es6-javascript</li>
<li>autocomplete-python</li>
<li>python-tools</li>
<li>atom-python-run</li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="atom_package"><a href="#atom_package" class="headerlink" title="atom package"></a>atom package</h3><h4 id="u5FC5_u5907"><a href="#u5]]>
    </summary>
    
      <category term="atom" scheme="https://annilq.github.io/tags/atom/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[iOS开发记录]]></title>
    <link href="https://annilq.github.io/2016/11/15/ios-tip/"/>
    <id>https://annilq.github.io/2016/11/15/ios-tip/</id>
    <published>2016-11-15T11:43:21.000Z</published>
    <updated>2016-11-15T14:39:34.000Z</updated>
    <content type="html"><![CDATA[<h3 id="UIview"><a href="#UIview" class="headerlink" title="UIview"></a>UIview</h3><h5 id="u5B50_u7C7B_u7684_u6A21_u7248_u4F1A_u81EA_u52A8_u751F_u6210_u4E24_u4E2A_u65B9_u6CD5"><a href="#u5B50_u7C7B_u7684_u6A21_u7248_u4F1A_u81EA_u52A8_u751F_u6210_u4E24_u4E2A_u65B9_u6CD5" class="headerlink" title="子类的模版会自动生成两个方法"></a>子类的模版会自动生成两个方法</h5><ol>
<li>initWithFrame</li>
<li>drawRect<br>初始化直接创建初始化子类并且加入到UIwindow中</li>
</ol>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Someview *view=<span class="comment">[<span class="comment">[Someview alloc]</span> initWithFrame:frame]</span>;</span><br><span class="line"><span class="comment">[self.window addsubview:view]</span>;</span><br><span class="line"><span class="comment">[self.window makeKeyAndVisiable]</span>;</span><br></pre></td></tr></table></figure>
<h3 id="u89C6_u56FE_u63A7_u5236_u5668UIViewController"><a href="#u89C6_u56FE_u63A7_u5236_u5668UIViewController" class="headerlink" title="视图控制器UIViewController"></a>视图控制器UIViewController</h3><ol>
<li>每一个controller都有一个view属性作为这个controller的根视图</li>
<li>controller的默认初始化方法是<code>initWithNibName:bundle</code><br>当像controller发送init消息时候会自动调用<code>initWithNibName:bundle</code>方法并且参数传入nil<blockquote>
<p>当传入了nil时controller对象仍然会找和当前controller同名xib文件</p>
</blockquote>
</li>
</ol>
<h5 id="u89C6_u56FE_u63A7_u5236_u5668_u53EF_u4EE5_u901A_u8FC7_u4E24_u79CD_u65B9_u5F0F_u521B_u5EFA_u89C6_u56FE_u5C42_u6B21_u7ED3_u6784"><a href="#u89C6_u56FE_u63A7_u5236_u5668_u53EF_u4EE5_u901A_u8FC7_u4E24_u79CD_u65B9_u5F0F_u521B_u5EFA_u89C6_u56FE_u5C42_u6B21_u7ED3_u6784" class="headerlink" title="视图控制器可以通过两种方式创建视图层次结构"></a>视图控制器可以通过两种方式创建视图层次结构</h5><ol>
<li><p>代码方式：覆盖UIViewController中的loadView方法(如果当前controller的view属性未nil则自动调用loadview方法)</p>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-(void)loadView</span><br><span class="line">&#123;</span><br><span class="line">  someView *<span class="built_in">view</span>=[[someView alloc] init];</span><br><span class="line">  self.<span class="built_in">view</span>=<span class="built_in">view</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>nib文件方式(相应的controller载入由nib编译撑的xib文件再生成视图)</p>
<h5 id="u5C06controller_u7684view_u6DFB_u52A0_u5230_u4E3B_u7A97_u53E3"><a href="#u5C06controller_u7684view_u6DFB_u52A0_u5230_u4E3B_u7A97_u53E3" class="headerlink" title="将controller的view添加到主窗口"></a>将controller的view添加到主窗口</h5></li>
<li>因为rootViewController的view需要启动后马上显示，所以会在设置完立刻加载view<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">somecontroller *<span class="stream">con</span>=[[somecontroller alloc] init]</span><br><span class="line">self.window.rootViewController=<span class="stream">con</span>;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="controller_u4E2D_u7684_u65B9_u6CD5_u7B80_u4ECB"><a href="#controller_u4E2D_u7684_u65B9_u6CD5_u7B80_u4ECB" class="headerlink" title="controller中的方法简介"></a>controller中的方法简介</h5><ol>
<li><code>initWithBundle</code>:当对视图控制器属性初始化时可以，还不能访问视图对象</li>
<li><code>viewDidLoad</code>:当像访问视图对象时候可以访问，但只执行一次</li>
<li><code>viewWillAppear</code>:每次看到view都会执行</li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="UIview"><a href="#UIview" class="headerlink" title="UIview"></a>UIview</h3><h5 id="u5B50_u7C7B_u7684_u6A21_u7248_u4F1A_u81EA_u52A8_u]]>
    </summary>
    
      <category term="iOS开发记录" scheme="https://annilq.github.io/tags/iOS%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[简单的事件订阅发布]]></title>
    <link href="https://annilq.github.io/2016/10/15/emitter/"/>
    <id>https://annilq.github.io/2016/10/15/emitter/</id>
    <published>2016-10-15T13:44:01.000Z</published>
    <updated>2017-11-29T12:34:25.000Z</updated>
    <content type="html"><![CDATA[<p>忘记是参考哪里了<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Emitter</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>._ctx = <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> EmitterProto = Emitter.prototype,</span><br><span class="line">    slice = [].slice</span><br><span class="line"></span><br><span class="line">EmitterProto.on = <span class="function"><span class="keyword">function</span>(<span class="params">event, fn</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>._cbs = <span class="keyword">this</span>._cbs || &#123;&#125;</span><br><span class="line">    ;(<span class="keyword">this</span>._cbs[event] = <span class="keyword">this</span>._cbs[event] || [])</span><br><span class="line">        .push(fn)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Emitter.prototype.once = <span class="function"><span class="keyword">function</span>(<span class="params">event, fn</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span></span><br><span class="line">    <span class="keyword">this</span>._cbs = <span class="keyword">this</span>._cbs || &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">on</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        self.off(event, on)</span><br><span class="line">        fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    on.fn = fn</span><br><span class="line">    <span class="keyword">this</span>.on(event, on)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Emitter.prototype.off = <span class="function"><span class="keyword">function</span>(<span class="params">event, fn</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>._cbs = <span class="keyword">this</span>._cbs || &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// all</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">arguments</span>.length) &#123;</span><br><span class="line">        <span class="keyword">this</span>._cbs = &#123;&#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// specific event</span></span><br><span class="line">    <span class="keyword">var</span> callbacks = <span class="keyword">this</span>._cbs[event]</span><br><span class="line">    <span class="keyword">if</span> (!callbacks) <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// remove all handlers</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">arguments</span>.length === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">delete</span> <span class="keyword">this</span>._cbs[event]</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// remove specific handler</span></span><br><span class="line">    <span class="keyword">var</span> cb</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; callbacks.length; i++) &#123;</span><br><span class="line">        cb = callbacks[i]</span><br><span class="line">        <span class="keyword">if</span> (cb === fn || cb.fn === fn) &#123;</span><br><span class="line">            callbacks.splice(i, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Emitter.prototype.emit = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>._cbs = <span class="keyword">this</span>._cbs || &#123;&#125;</span><br><span class="line">    <span class="keyword">var</span> args = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>),</span><br><span class="line">        callbacks = <span class="keyword">this</span>._cbs[event]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (callbacks) &#123;</span><br><span class="line">        callbacks = callbacks.slice(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = callbacks.length; i &lt; len; i++) &#123;</span><br><span class="line">            callbacks[i].apply(<span class="keyword">this</span>._ctx, args)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> aa=<span class="keyword">new</span> Emitter()</span><br><span class="line">    aa.on(<span class="string">"hello"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"say hello"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// module.exports = Emitter</span></span><br></pre></td></tr></table></figure></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>忘记是参考哪里了<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</]]>
    </summary>
    
      <category term="pub sub" scheme="https://annilq.github.io/tags/pub-sub/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[vue小记]]></title>
    <link href="https://annilq.github.io/2016/10/14/vue/"/>
    <id>https://annilq.github.io/2016/10/14/vue/</id>
    <published>2016-10-14T13:28:01.000Z</published>
    <updated>2017-11-29T12:34:25.000Z</updated>
    <content type="html"><![CDATA[<ol>
<li><p>首先通过构造函数传入vue实例的作用域el<br>在el上面查找所有的vue指令生成一个array</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">selector= <span class="built_in">Object</span>.keys(Directives).map(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'['</span> + prefix + <span class="string">'-'</span> + d + <span class="string">']'</span></span><br><span class="line">    &#125;).join()</span><br><span class="line">els  = root.querySelectorAll(selector)</span><br></pre></td></tr></table></figure>
</li>
<li><p>解析使用指令的dom的，返回一个object,里面包含指令所需的数据key,filter,update(）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"attr"</span>: attr,<span class="comment">//包含指令的key,value</span></span><br><span class="line">    <span class="string">"key"</span>: key,<span class="comment">//该directive依赖的外部数据</span></span><br><span class="line">    <span class="string">"filters"</span>: filters,<span class="comment">//model 用的filter</span></span><br><span class="line">    <span class="string">"definition"</span>: def,<span class="comment">//内部的directive name</span></span><br><span class="line">    <span class="string">"argument"</span>: arg,</span><br><span class="line">    <span class="comment">/*</span><br><span class="line">    如果指令名字是function，则使用function做为model change</span><br><span class="line">    handle，如果指令是一个对象，则使用对象自己实现的update做为model change</span><br><span class="line">    handle（所以每一个自定义指令都要实现update方法</span><br><span class="line">    */</span></span><br><span class="line">    <span class="string">"update"</span>: <span class="keyword">typeof</span> def === <span class="string">'function'</span> ? def: def.update</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>之后将dom中的指令标记删除恢复到普通的dom<br>并且整理出directive需要的key,<br>再将数据key与对应的directive生成一个依赖map(当key发生变化时会更新对应的directive)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">directive为以来此数据的指令，value为key实际的值</span><br><span class="line">*/</span></span><br><span class="line">&#123;</span><br><span class="line">	key:&#123;directive:[],value&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>最后设置当前key的setter与getter方法,在调用setter方法中设置当前数据对象的值并且依次调用依赖directive中的update方法实现view model的更新<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.defineProperty(seed.scope, key, &#123;</span><br><span class="line">        get: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> binding.value</span><br><span class="line">        &#125;,</span><br><span class="line">        set: <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">            binding.value = value</span><br><span class="line">            binding.directives.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">directive</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (value &amp;&amp; directive.filters) &#123;</span><br><span class="line">                    value = applyFilters(value, directive)</span><br><span class="line">                &#125;</span><br><span class="line">                directive.update(</span><br><span class="line">                    directive.el,</span><br><span class="line">                    value,</span><br><span class="line">                    directive.argument,</span><br><span class="line">                    directive,</span><br><span class="line">                    seed</span><br><span class="line">                )</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure></p>
]]></content>
    <summary type="html">
    <![CDATA[<ol>
<li><p>首先通过构造函数传入vue实例的作用域el<br>在el上面查找所有的vue指令生成一个array</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><s]]>
    </summary>
    
      <category term="vue" scheme="https://annilq.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[用cordova命令行给应用程序签名]]></title>
    <link href="https://annilq.github.io/2016/01/07/Cordovarelease/"/>
    <id>https://annilq.github.io/2016/01/07/Cordovarelease/</id>
    <published>2016-01-07T13:44:01.000Z</published>
    <updated>2016-04-18T16:05:36.000Z</updated>
    <content type="html"><![CDATA[<p>最近再用cordova做hybrid项目，之前一直用debug模式build，由于后来消息推送用到了极光推送，debug模式打出的包会有极光推送的提示（发布打包不会出现），体验十分不好，所以决定打一个release包，生成的签名是参考<a href="http://lzw.me/a/cordova-3-5-android-apk-signed.html" target="_blank" rel="external">这个做的</a><br>首先生成<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -genkey -v -keystore annilq<span class="class">.keystore</span> -alias annilq -keyalg RSA -validity <span class="number">3650</span></span><br></pre></td></tr></table></figure></p>
<p>按照命令行提示<br>下面是我生成签名的截图<br><img src="/images/annilq.keystore.png" alt=""><br>以上都没有问题，但是按照上面的博客打包的时候一直不能打sign包，后来看了<a href="https://cordova.apache.org/docs/en/dev/guide/platforms/android/tools.html" target="_blank" rel="external">cordova文档</a>发现应该按照以下方式修改<br>新建 name.properties 文件,命名参考</p>
<blockquote>
<p>cdvDebugSigningPropertiesFile (default: debug-signing.properties)//如果是开发包<br>cdvReleaseSigningPropertiesFile (default: release-signing.properties)//如果是发布包</p>
</blockquote>
<p>内容如下<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">key.store=annilq<span class="class">.keystore</span></span><br><span class="line">key.alias=annilq</span><br><span class="line">key<span class="class">.store</span><span class="class">.password</span>=<span class="number">123456</span>liu</span><br><span class="line">key<span class="class">.alias</span><span class="class">.password</span>=<span class="number">123456</span>liu</span><br></pre></td></tr></table></figure></p>
<p>文件放在platforms/android/目录下<br>这时候再执行<code>cordova build android -release</code>即可以成功</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>最近再用cordova做hybrid项目，之前一直用debug模式build，由于后来消息推送用到了极光推送，debug模式打出的包会有极光推送的提示（发布打包不会出现），体验十分不好，所以决定打一个release包，生成的签名是参考<a href="http://lzw.]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[利用hexo github 搭建个人博客注意事项]]></title>
    <link href="https://annilq.github.io/2015/12/25/hexo-start/"/>
    <id>https://annilq.github.io/2015/12/25/hexo-start/</id>
    <published>2015-12-25T13:44:20.000Z</published>
    <updated>2016-04-18T15:41:30.000Z</updated>
    <content type="html"><![CDATA[<p>安装<a href="https://git-scm.com/downloads" target="_blank" rel="external">Git</a>,<a href="https://nodejs.org/en/" target="_blank" rel="external">Nodejs</a>之后依次执行下面代码安装hexo-cli,初始化博客<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="operator"><span class="keyword">install</span> hexo-cli -<span class="keyword">g</span></span><br><span class="line">hexo init blog</span><br><span class="line">cd blog</span><br><span class="line">npm <span class="keyword">install</span></span><br><span class="line">hexo <span class="keyword">server</span></span></span><br></pre></td></tr></table></figure></p>
<p>日常用的命令下面几个就够了,具体的可以查看hexo官网的<a href="https://hexo.io/zh-cn/docs/commands.html" target="_blank" rel="external">常用命令</a></p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hexo <span class="keyword">new</span> &lt;title&gt;<span class="comment">//创建文章</span></span><br><span class="line">hexo <span class="keyword">server</span> <span class="comment">//开启服务器可以实时预览</span></span><br><span class="line">hexo generate<span class="comment">//生成静态文件</span></span><br><span class="line">hexo deploy<span class="comment">//部署文件</span></span><br><span class="line"><span class="comment">//上面两部可以一次性写成</span></span><br><span class="line">hexo deploy --generate</span><br></pre></td></tr></table></figure>
<p>最后可以将写好的博客部署到<a href="https://help.github.com/articles/creating-pages-with-the-automatic-generator/" target="_blank" rel="external">github pages</a>上面<br>首先注册一个github账号新建仓库名称为<code>username.github.io</code>,比如我的github账号是<a href="https://github.com/annilq" target="_blank" rel="external">annilq</a>, 新建的仓库名则命名为<code>annilq.github.io</code><br>最后修改博客根目录下面的_config.yml文件下的deploy部分如下(下面对应的用户名部分改成自己的用户名就可以)<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">deploy</span>:</span><br><span class="line">  <span class="attribute">type</span>: git</span><br><span class="line">  <span class="attribute">repo</span>: <span class="attribute">https</span>:<span class="comment">//github.com/annilq/annilq.github.io</span></span><br><span class="line">  (<span class="attribute">https</span>:<span class="comment">//github.com/&lt;yourname&gt;/&lt;yourname&gt;.github.io)</span></span><br><span class="line">  <span class="attribute">branch</span>: master</span><br></pre></td></tr></table></figure></p>
<p>最后执行<code>hexo deploy</code>就可以将博客发布到github pages上面<br>访问<a href="http://annilq.github.io">http://annilq.github.io</a>就可以看到<br>关于以上<a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="external">hexo官方文档</a>都有详细说明<br>over…</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>安装<a href="https://git-scm.com/downloads" target="_blank" rel="external">Git</a>,<a href="https://nodejs.org/en/" target="_blank" rel="ex]]>
    </summary>
    
      <category term="hexo github" scheme="https://annilq.github.io/tags/hexo-github/"/>
    
  </entry>
  
</feed>
